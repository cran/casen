<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Mauricio Vargas" />

<meta name="date" content="2022-09-03" />

<title>Uso basico del paquete casen</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Uso basico del paquete casen</h1>
<h4 class="author">Mauricio Vargas</h4>
<h4 class="date">2022-09-03</h4>



<div id="datos-de-ejemplo" class="section level1">
<h1>Datos de ejemplo</h1>
<p>El uso de este paquete se mostrara a partir de los datos de ejemplo.
Vamos a leer un subconjunto de la encuesta CASEN que corresponde a las
comunas con representatividad comunal en la Region de los Rios. Estos
datos se incluyen, a modo de demostracion, con el paquete casen, no asi
las encuestas completas que deben ser descargadas y se provee una
funcion para hacerlo.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(casen)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>casen_2017_los_rios</span></code></pre></div>
<pre><code>## # A tibble: 8,055 × 7
##     expc varstrat     varunit ytotcorh       sexo           comuna       pobreza
##    &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl+lbl&gt;        &lt;dbl+lbl&gt;     &lt;dbl+lbl&gt;
##  1    53   141283 14128301184   959765 2 [Mujer]  14101 [Valdivia] 3 [No pobres]
##  2    53   141283 14128301184   959765 2 [Mujer]  14101 [Valdivia] 3 [No pobres]
##  3    53   141283 14128301184   959765 2 [Mujer]  14101 [Valdivia] 3 [No pobres]
##  4   105   141283 14128301184   283273 2 [Mujer]  14101 [Valdivia] 2 [Pobres no…
##  5   105   141283 14128301184   283273 1 [Hombre] 14101 [Valdivia] 2 [Pobres no…
##  6   105   141283 14128301184   283273 2 [Mujer]  14101 [Valdivia] 2 [Pobres no…
##  7   105   141283 14128301184   353083 2 [Mujer]  14101 [Valdivia] 3 [No pobres]
##  8   105   141283 14128301184   260000 2 [Mujer]  14101 [Valdivia] 2 [Pobres no…
##  9   105   141283 14128301184   260000 2 [Mujer]  14101 [Valdivia] 2 [Pobres no…
## 10   105   141283 14128301184   260000 1 [Hombre] 14101 [Valdivia] 2 [Pobres no…
## # … with 8,045 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
<div id="descargar-datos-desde-sitio-web-mds" class="section level1">
<h1>Descargar datos desde sitio web MDS</h1>
<p>Para descargar la encuesta CASEN es posible hacerlo desde el sitio
web del Ministerio de Desarrollo Social (oficial) o desde GitHub (no
oficial).</p>
<p>No se daran ejemplos con la encuesta casen completa ya que CRAN
limita el tiempo en segundos que puede tomar un ejemplo.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># todos los anios disponibles en carpeta casen-formato-stata</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">descargar_casen_mds</span>(<span class="st">&quot;casen-formato-stata&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># solo anio 2017 en carpeta casen-formato-stata</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">descargar_casen_mds</span>(<span class="dv">2017</span>, <span class="st">&quot;casen-formato-stata&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># leer encuesta CASEN en formato DTA (Stata)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># (se debe descomprimir con winRAR u otro)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">read_stata</span>(<span class="st">&quot;casen-formato-stata/Casen 2017.dta&quot;</span>)</span></code></pre></div>
</div>
<div id="descargar-datos-desde-github" class="section level1">
<h1>Descargar datos desde GitHub</h1>
<p>En la misma linea de la seccion anterior, es posible descargar la
encuesta CASEN en formato R.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># todos los anios disponibles</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">descargar_casen_github</span>(<span class="st">&quot;casen-formato-r&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># solo anio 2017</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">descargar_casen_github</span>(<span class="dv">2017</span>, <span class="st">&quot;casen-formato-r&quot;</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># leer encuesta CASEN en formato RDS (R)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">readRDS</span>(<span class="st">&quot;casen-formato-r/2017.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="disenios-complejos" class="section level1">
<h1>Disenios complejos</h1>
<p>El valor agregado del paquete CASEN es que entrega una forma facil de
hacer calculos tomando en cuenta, ademas del disenio complejo, los
grados de libertad.</p>
<p>En el contexto de muestreo bietapico, el calculo de los grados de
libertad es un tema no resuelto, pero el paquete casen utiliza la
siguiente definicion del INE: “Los grados de libertad corresponden a la
diferencia entre el numero de conglomerados no vacios (con presencia de
la variable de interes) y el numero de estratos no vacios”.</p>
<p>En dominios de estimacion pequenios la perdida de grados de libertad
se vuelve bastante relevante. Esto es muy importante cuando se hacen
calculos agrupando por region, sexo, region y sexo, entre otras.</p>
<p>Al usar la funcion <code>svyby</code> del paquete survey, la funcion
no calcula correctamente los grados de libertad de cada dominio, sino
que considera un valor fijo para todos los dominios. Las funciones del
paquete casen usan esta funcion pero incluyen una serie de pasos
programados para usar los grados de libertad adecuados para cada dominio
de estimacion.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># disenio complejo a partir de  los datos de ejemplo</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>cd <span class="ot">&lt;-</span> <span class="fu">configuracion_disenio</span>(casen_2017_los_rios, <span class="st">&quot;ytotcorh&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;comuna&quot;</span>, <span class="st">&quot;sexo&quot;</span>), <span class="st">&quot;expc&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>cd<span class="sc">$</span>disenio</span></code></pre></div>
<pre><code>## Stratified 1 - level Cluster Sampling design (with replacement)
## With (67) clusters.
## Called via srvyr
## Sampling variables:
##  - ids: varunit
##  - strata: varstrat
##  - weights: expc
## Data variables: ytotcorh (dbl), comuna (dbl+lbl), sexo (dbl+lbl), expc (dbl),
##   varunit (dbl), varstrat (dbl)</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>cd<span class="sc">$</span>grupos</span></code></pre></div>
<pre><code>## # A tibble: 12 × 2
##                 comuna       sexo
##              &lt;dbl+lbl&gt;  &lt;dbl+lbl&gt;
##  1 14101 [Valdivia]    2 [Mujer] 
##  2 14101 [Valdivia]    1 [Hombre]
##  3 14104 [Los Lagos]   1 [Hombre]
##  4 14104 [Los Lagos]   2 [Mujer] 
##  5 14107 [Paillaco]    1 [Hombre]
##  6 14107 [Paillaco]    2 [Mujer] 
##  7 14108 [Panguipulli] 2 [Mujer] 
##  8 14108 [Panguipulli] 1 [Hombre]
##  9 14201 [La Unión]    1 [Hombre]
## 10 14201 [La Unión]    2 [Mujer] 
## 11 14204 [Río Bueno]   1 [Hombre]
## 12 14204 [Río Bueno]   2 [Mujer]</code></pre>
</div>
<div id="medidas-de-tendencia-central-con-disenio-complejo" class="section level1">
<h1>Medidas de tendencia central con disenio complejo</h1>
<p>La funcion <code>estadistica_descriptiva()</code> toma en cuenta el
disenio complejo y los grados de libertad. Puedo agrupar por una o mas
variables y la funcion entrega, ademas del promedio, el intervalo de
confianza.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># media, mediana y percentil 70</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">media_agrupada</span>(cd)</span></code></pre></div>
<pre><code>## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## • Column `comuna`</code></pre>
<pre><code>## # A tibble: 12 × 8
## # Groups:   comuna_etiqueta [6]
##    comuna_etiq…¹ sexo_…² comuna_co…³ sexo_…⁴      comuna media…⁵ media…⁶ media…⁷
##        &lt;dbl+lbl&gt; &lt;chr&gt;     &lt;dbl+lbl&gt; &lt;chr&gt;     &lt;dbl+lbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 14101 [Valdi… Mujer   14101 [Val… 2       14101 [Val…  1.26e6  1.03e6  1.50e6
##  2 14101 [Valdi… Hombre  14101 [Val… 1       14101 [Val…  1.35e6  1.07e6  1.62e6
##  3 14104 [Los L… Hombre  14104 [Los… 1       14104 [Los…  7.19e5  6.39e5  7.98e5
##  4 14104 [Los L… Mujer   14104 [Los… 2       14104 [Los…  7.31e5  6.40e5  8.21e5
##  5 14107 [Paill… Hombre  14107 [Pai… 1       14107 [Pai…  7.08e5  4.23e5  9.92e5
##  6 14107 [Paill… Mujer   14107 [Pai… 2       14107 [Pai…  6.89e5  4.52e5  9.26e5
##  7 14108 [Pangu… Mujer   14108 [Pan… 2       14108 [Pan…  6.31e5  5.38e5  7.24e5
##  8 14108 [Pangu… Hombre  14108 [Pan… 1       14108 [Pan…  6.85e5  6.29e5  7.41e5
##  9 14201 [La Un… Hombre  14201 [La … 1       14201 [La …  8.05e5  7.07e5  9.02e5
## 10 14201 [La Un… Mujer   14201 [La … 2       14201 [La …  7.52e5  6.64e5  8.39e5
## 11 14204 [Río B… Hombre  14204 [Río… 1       14204 [Río…  7.73e5  6.61e5  8.84e5
## 12 14204 [Río B… Mujer   14204 [Río… 2       14204 [Río…  7.14e5  6.08e5  8.20e5
## # … with abbreviated variable names ¹​comuna_etiqueta, ²​sexo_etiqueta,
## #   ³​comuna_codigo, ⁴​sexo_codigo, ⁵​media_ytotcorh, ⁶​media_ytotcorh_inf,
## #   ⁷​media_ytotcorh_sup</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mediana_agrupada</span>(cd)</span></code></pre></div>
<pre><code>## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## • Column `comuna`</code></pre>
<pre><code>## # A tibble: 12 × 8
## # Groups:   comuna_etiqueta [6]
##    comuna_etiq…¹ sexo_…² comuna_co…³ sexo_…⁴      comuna media…⁵ media…⁶ media…⁷
##        &lt;dbl+lbl&gt; &lt;chr&gt;     &lt;dbl+lbl&gt; &lt;chr&gt;     &lt;dbl+lbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 14101 [Valdi… Mujer   14101 [Val… 2       14101 [Val…  900000  794484 1005866
##  2 14101 [Valdi… Hombre  14101 [Val… 1       14101 [Val…  914646  810887 1047226
##  3 14104 [Los L… Hombre  14104 [Los… 1       14104 [Los…  613990  579550  645000
##  4 14104 [Los L… Mujer   14104 [Los… 2       14104 [Los…  635936  582273  665000
##  5 14107 [Paill… Hombre  14107 [Pai… 1       14107 [Pai…  553684  450000  710646
##  6 14107 [Paill… Mujer   14107 [Pai… 2       14107 [Pai…  532732  393687  996667
##  7 14108 [Pangu… Mujer   14108 [Pan… 2       14108 [Pan…  532472  531391  552156
##  8 14108 [Pangu… Hombre  14108 [Pan… 1       14108 [Pan…  560000  531391  632064
##  9 14201 [La Un… Hombre  14201 [La … 1       14201 [La …  624669  564167  699167
## 10 14201 [La Un… Mujer   14201 [La … 2       14201 [La …  573938  522321  698745
## 11 14204 [Río B… Hombre  14204 [Río… 1       14204 [Río…  707156  577642  757785
## 12 14204 [Río B… Mujer   14204 [Río… 2       14204 [Río…  631806  513536  730000
## # … with abbreviated variable names ¹​comuna_etiqueta, ²​sexo_etiqueta,
## #   ³​comuna_codigo, ⁴​sexo_codigo, ⁵​mediana_ytotcorh, ⁶​mediana_ytotcorh_inf,
## #   ⁷​mediana_ytotcorh_sup</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">percentiles_agrupados</span>(cd)</span></code></pre></div>
<pre><code>## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## `mutate_if()` ignored the following grouping variables:
## • Column `comuna`</code></pre>
<pre><code>## # A tibble: 12 × 8
## # Groups:   comuna_etiqueta [6]
##    percentil comuna_et…¹ sexo_…² comuna_co…³ sexo_…⁴      comuna media…⁵ media…⁶
##        &lt;dbl&gt;   &lt;dbl+lbl&gt; &lt;chr&gt;     &lt;dbl+lbl&gt; &lt;chr&gt;     &lt;dbl+lbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1       0.7 14101 [Val… Mujer   14101 [Val… 2       14101 [Val… 1268480 101816.
##  2       0.7 14101 [Val… Hombre  14101 [Val… 1       14101 [Val… 1300000 100874.
##  3       0.7 14104 [Los… Hombre  14104 [Los… 1       14104 [Los…  853162  25455.
##  4       0.7 14104 [Los… Mujer   14104 [Los… 2       14104 [Los…  853162  50598.
##  5       0.7 14107 [Pai… Hombre  14107 [Pai… 1       14107 [Pai…  796676 215415.
##  6       0.7 14107 [Pai… Mujer   14107 [Pai… 2       14107 [Pai…  792246 224112.
##  7       0.7 14108 [Pan… Mujer   14108 [Pan… 2       14108 [Pan…  700000  57176.
##  8       0.7 14108 [Pan… Hombre  14108 [Pan… 1       14108 [Pan…  784167  40130.
##  9       0.7 14201 [La … Hombre  14201 [La … 1       14201 [La …  821331  24642.
## 10       0.7 14201 [La … Mujer   14201 [La … 2       14201 [La …  786368  58745.
## 11       0.7 14204 [Río… Hombre  14204 [Río… 1       14204 [Río…  836333  42714.
## 12       0.7 14204 [Río… Mujer   14204 [Río… 2       14204 [Río…  769578  56308.
## # … with abbreviated variable names ¹​comuna_etiqueta, ²​sexo_etiqueta,
## #   ³​comuna_codigo, ⁴​sexo_codigo, ⁵​mediana_ytotcorh, ⁶​mediana_ytotcorh_err_est</code></pre>
</div>
<div id="uso-de-las-funciones-de-casen-y-dplyr" class="section level1">
<h1>Uso de las funciones de casen y dplyr</h1>
<p>Las funciones de <code>casen</code> estan pensadas para usarse en
conjunto con las de <code>dplyr</code>. Un ejemplo simple de esto es el
calculo del porcentaje de hogares pobres.</p>
<p>Veamos el caso puntual de las funciones <code>mutate</code> y
<code>filter</code> de dplyr.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convierto pobreza a una variable binaria</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>casen_2017_los_rios <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pobreza =</span> <span class="fu">ifelse</span>(pobreza <span class="sc">&lt;=</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">configuracion_disenio</span>(<span class="st">&quot;pobreza&quot;</span>, <span class="st">&quot;comuna&quot;</span>, <span class="st">&quot;expc&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">media_agrupada</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   comuna_etiqueta comuna_codigo media_pobreza media_pobreza_inf media_pobreza_…¹
##   &lt;chr&gt;           &lt;chr&gt;                 &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;
## 1 Valdivia        14101                0.0753            0.0513           0.0993
## 2 Los Lagos       14104                0.156             0.104            0.209 
## 3 Paillaco        14107                0.209            -0.0754           0.494 
## 4 Panguipulli     14108                0.133             0.0928           0.173 
## 5 La Unión        14201                0.132             0.0656           0.198 
## 6 Río Bueno       14204                0.170             0.0736           0.266 
## # … with abbreviated variable name ¹​media_pobreza_sup</code></pre>
</div>
<div id="inferencia-con-disenios-complejos" class="section level1">
<h1>Inferencia con disenios complejos</h1>
<p>El paquete casen provee dos funciones para sacar el maximo partido a
las funciones de R tomando en cuenta el disenio complejo y los grados de
libertad.</p>
<p>Ajuste del modelo:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo: ytotcorh = b0 + b1 comuna + b2 sexo + e</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">modelo_lineal_generalizado</span>(cd, <span class="st">&quot;ytotcorh ~ comuna + sexo&quot;</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<pre><code>## 
## Call:
## svyglm(formula = stats::as.formula(modelo), design = disenio$disenio)
## 
## Survey design:
## Called via srvyr
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 55655084.7 13884444.7   4.008 0.000192 ***
## comuna         -3860.7      977.4  -3.950 0.000232 ***
## sexo          -58713.5    23514.9  -2.497 0.015672 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 1.491064e+12)
## 
## Number of Fisher Scoring iterations: 2</code></pre>
</div>
<div id="uso-de-las-funciones-de-casen-con-paquetes-tidy" class="section level1">
<h1>Uso de las funciones de casen con paquetes “tidy”</h1>
<p>Ademas de dplyr, casen se integra perfectamente con los paquetes del
<a href="https://www.tidyverse.org/">Tidyverse</a> y otros paquetes
afines.</p>
<p>Por ejemplo, el paquete broom permite obtener una tabla con los
intervalos de confianza para los betas estimados del modelo.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span></code></pre></div>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loading required package: survival</code></pre>
<pre><code>## 
## Attaching package: &#39;survey&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     dotchart</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;janitor&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     chisq.test, fisher.test</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># usamos ddf y degf del paquete survey para hacer el mismo calculo</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># que realiza Stata</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>mod_conf <span class="ot">&lt;-</span> <span class="fu">confint_tidy</span>(mod, <span class="at">ddf =</span> <span class="fu">degf</span>(cd<span class="sc">$</span>disenio))</span></code></pre></div>
<pre><code>## Warning: confint_tidy is now deprecated and will be removed from a future
## release of broom. Please use the applicable confint method.</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>mod_conf</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##    conf.low conf.high
##       &lt;dbl&gt;     &lt;dbl&gt;
## 1 27830036. 83480134.
## 2    -5820.    -1902.
## 3  -105838.   -11589.</code></pre>
<p>Lo anterior se puede ordenar y presentar los betas junto con los
intervalos de confianza.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ordenamos la salida del modelo</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>mod_betas <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pegamos las columnas</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>mod_betas <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(mod_betas, mod_conf)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ordenamos los nombres de las columnas</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>mod_betas <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(mod_betas)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>mod_betas</span></code></pre></div>
<pre><code>## # A tibble: 3 × 7
##   term         estimate std_error statistic  p_value  conf_low conf_high
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept) 55655085. 13884445.      4.01 0.000192 27830036. 83480134.
## 2 comuna         -3861.      977.     -3.95 0.000232    -5820.    -1902.
## 3 sexo          -58714.    23515.     -2.50 0.0157    -105838.   -11589.</code></pre>
</div>
<div id="comparabilidad-entre-encuestas" class="section level1">
<h1>Comparabilidad entre encuestas</h1>
<p>El paquete casen provee un conjunto de datos con la correspondencia
de los codigos de comunas.</p>
<p>Veamos como convertir los codigos de la encuesta CASEN 1990 a codigos
SUBDERE 2017.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>codigos_casen <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(valido_desde <span class="sc">==</span> <span class="dv">1990</span>)</span></code></pre></div>
<pre><code>## # A tibble: 323 × 4
## # Groups:   codigo_casen, codigo_subdere_2017 [323]
##    valido_desde valido_hasta codigo_casen codigo_subdere_2017
##           &lt;dbl&gt;        &lt;dbl&gt;        &lt;int&gt; &lt;chr&gt;              
##  1         1990         2017        11201 11201              
##  2         1990         2003         5605 05602              
##  3         1990         2003        13504 13502              
##  4         1990         2003         3304 03302              
##  5         1990         2003         1307 01107              
##  6         1990         2003        10402 10202              
##  7         1990         2003         4104 04103              
##  8         1990         2003         9101 09201              
##  9         1990         2003         2301 02101              
## 10         1990         2003         8204 08302              
## # … with 313 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>casen1990 <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">&quot;casen-formato-spss/1990.sav&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comu =</span> <span class="fu">as.integer</span>(comu)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    codigos_casen <span class="sc">%&gt;%</span> <span class="fu">filter</span>(valido_desde <span class="sc">==</span> <span class="dv">1990</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;codigo&quot;</span>)),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;comu&quot;</span> <span class="ot">=</span> <span class="st">&quot;codigo_casen&quot;</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
